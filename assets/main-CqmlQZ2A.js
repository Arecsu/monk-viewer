var m=Object.defineProperty;var u=(n,t,e)=>t in n?m(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>u(n,typeof t!="symbol"?t+"":t,e);import{i as p}from"./shared-orbitcontrols-f2qxSFef.js";import"./vendor-three-N7lV2Ffk.js";import"./gainmap-js-DCWFOtnI.js";import"./postprocessing-DUWFfstC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const l=class l{constructor(t,e,i){c(this,"id");c(this,"worker");c(this,"element");c(this,"resizeObserver");this.id=l.nextId++,this.worker=e,this.element=t;const o=a=>{this.worker.postMessage({type:"event",id:this.id,data:a})};this.worker.postMessage({type:"makeProxy",id:this.id});const s=()=>{const a=this.element.getBoundingClientRect();o({type:"size",left:a.left,top:a.top,width:this.element.clientWidth,height:this.element.clientHeight,pixelRatio:window.devicePixelRatio||1})};this.resizeObserver=new ResizeObserver(()=>{requestAnimationFrame(s)}),s(),this.resizeObserver.observe(t),this.attachHandlers(i,o)}attachHandlers(t,e){Object.entries(t).forEach(([i,o])=>{this.element.addEventListener(i,s=>{const a=o(s);e(a)})})}disconnect(){this.resizeObserver.disconnect()}};c(l,"nextId",0);let d=l;function r(n){return t=>n(t)}function h(n){return t=>{const e={type:t.type};return n.forEach(i=>{i in t&&(e[i]=t[i])}),e}}function f(){return n=>(n.preventDefault(),{type:n.type,touches:Array.from(n.touches).map(t=>({pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY}))})}const v=()=>{const n=h(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pointerId","pageX","pageY"]),t=f();return{contextmenu:r(e=>(e.preventDefault(),{type:e.type})),mousedown:r(n),mousemove:r(n),mouseup:r(n),mouseleave:r(n),pointerdown:r(n),pointermove:r(n),pointerup:r(n),pointerout:r(n),wheel:r(e=>(e.preventDefault(),{type:e.type,deltaX:e.deltaX,deltaY:e.deltaY})),touchstart:r(t),touchmove:r(t),touchend:r(t),keydown:r(e=>({type:e.type,key:e.key,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey}))}};function g(){const n=/Macintosh(?!.*KHTML).*Gecko/i.test(navigator.userAgent),t=/Android(?!.*KHTML).*Gecko/i.test(navigator.userAgent);return n||t?{disableMSAA:!0,lowResolution:!0}:{disableMSAA:!1,lowResolution:!1}}class y extends HTMLElement{constructor(){super();c(this,"canvas");c(this,"commonOptions");this.canvas=document.createElement("canvas");const e=this.getAttribute("model")||"",i=this.getAttribute("envmap")||"",o=parseFloat(this.getAttribute("target-distance")||"0.8"),s=parseFloat(this.getAttribute("min-distance")||"0.1"),a=parseFloat(this.getAttribute("max-distance")||"1.0");this.commonOptions={pixelRatio:window.devicePixelRatio||1,modelUrl:e,envmapUrl:i,minDistance:s,targetDistance:o,maxDistance:a,lowPerformanceSettings:g()}}connectedCallback(){this.appendChild(this.canvas),this.logAttributes(),this.initScene()}logAttributes(){console.log("Model URL:",this.commonOptions.modelUrl),console.log("Max distance:",this.commonOptions.maxDistance),console.log("Target distance:",this.commonOptions.targetDistance),console.log("Min distance:",this.commonOptions.minDistance),console.log("Envmap URL:",this.commonOptions.envmapUrl)}isValidURL(e){if(!e)return!1;try{return new URL(e,document.baseURI),!0}catch{return!1}}startWorker(e){console.log(e);const i=e.transferControlToOffscreen(),o=new Worker(new URL("/monk-viewer/assets/offscreencanvas-worker-orbitcontrol-JahlzCme.js",import.meta.url),{type:"module"}),s=new d(e,o,v());o.postMessage({type:"start",canvas:i,canvasId:s.id,...this.commonOptions},[i])}initScene(){if(!this.canvas)return;const e=this.isValidURL(this.commonOptions.modelUrl),i=this.isValidURL(this.commonOptions.envmapUrl);if(!(e&&i)){console.warn("No valid model or envmap found. Scene won't be initialized.");return}this.canvas.transferControlToOffscreen!==void 0?this.startWorker(this.canvas):p({canvas:this.canvas,inputElement:this.canvas,...this.commonOptions})}}customElements.define("monk-view",y);
