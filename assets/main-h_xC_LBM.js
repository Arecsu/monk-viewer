var p=Object.defineProperty;var h=(s,e,t)=>e in s?p(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>h(s,typeof e!="symbol"?e+"":e,t);import{i as f}from"./shared-orbitcontrols-BAgjUnjK.js";import"./vendor-three-B7e9swDm.js";import"./gainmap-js-BcMciYQH.js";import"./postprocessing-Nk9AJhDE.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function u(s){return Math.min(window.devicePixelRatio||1,s)}const d=class d{constructor(e,t,i,n){c(this,"id",d.nextId++);c(this,"worker");c(this,"element");c(this,"resizeObserver");c(this,"limitPixelRatio");this.worker=t,this.element=e,this.limitPixelRatio=n;const o=l=>{this.worker.postMessage({type:"event",id:this.id,data:l})};this.worker.postMessage({type:"makeProxy",id:this.id});const a=()=>{const l=this.element.getBoundingClientRect();o({type:"size",left:l.left,top:l.top,width:this.element.clientWidth,height:this.element.clientHeight,pixelRatio:u(this.limitPixelRatio)})};this.resizeObserver=new ResizeObserver(()=>{requestAnimationFrame(a)}),a(),this.resizeObserver.observe(e),this.attachHandlers(i,o)}attachHandlers(e,t){Object.entries(e).forEach(([i,n])=>{this.element.addEventListener(i,o=>{const a=n(o);t(a)})})}disconnect(){this.resizeObserver.disconnect()}};c(d,"nextId",0);let m=d;function r(s){return e=>s(e)}function v(s){return e=>{const t={type:e.type};return s.forEach(i=>{i in e&&(t[i]=e[i])}),t}}function g(){return s=>(s.preventDefault(),{type:s.type,touches:Array.from(s.touches).map(e=>({pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY}))})}const y=s=>{const e=v(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pointerId","pageX","pageY"]),t=g();return{contextmenu:r(i=>(i.preventDefault(),{type:i.type})),click:r(e),mousedown:r(e),mousemove:r(e),mouseup:r(e),mouseleave:r(e),pointerdown:r(e),pointermove:r(e),pointerup:r(e),pointerout:r(e),wheel:r(i=>(s.isInteractive&&i.preventDefault(),{type:i.type,deltaX:i.deltaX,deltaY:i.deltaY})),touchstart:r(t),touchmove:r(t),touchend:r(t),keydown:r(i=>({type:i.type,key:i.key,ctrlKey:i.ctrlKey,metaKey:i.metaKey,shiftKey:i.shiftKey}))}};function w(){const s=/Macintosh(?!.*KHTML).*Gecko/i.test(navigator.userAgent),e=/Android(?!.*KHTML).*Gecko/i.test(navigator.userAgent),t=/Android/i.test(navigator.userAgent);return s||e?{disableAA:!0,lowResolution:!0}:t?{disableAA:!0,lowResolution:!1}:{disableAA:!1,lowResolution:!1}}class b extends HTMLElement{constructor(){super();c(this,"canvas");c(this,"commonOptions");c(this,"isInteractive",!1);c(this,"limitPixelRatio",/Android/i.test(navigator.userAgent)?2:1/0);this.canvas=document.createElement("canvas");const t=this.getAttribute("model")||"",i=this.getAttribute("envmap")||"",n=parseFloat(this.getAttribute("target-distance")||"0.8"),o=parseFloat(this.getAttribute("min-distance")||"0.1"),a=parseFloat(this.getAttribute("max-distance")||"1.0"),l={stabilityDuration:parseFloat(this.getAttribute("perf-stability-duration")||"1.0"),measureDuration:parseFloat(this.getAttribute("perf-measure-duration")||"0.5")};this.commonOptions={pixelRatio:u(this.limitPixelRatio),modelUrl:t,envmapUrl:i,minDistance:o,targetDistance:n,maxDistance:a,lowPerformanceSettings:w(),perfSampling:l}}connectedCallback(){this.appendChild(this.canvas),this.logAttributes(),this.initScene()}logAttributes(){console.log("Model URL:",this.commonOptions.modelUrl),console.log("Max distance:",this.commonOptions.maxDistance),console.log("Target distance:",this.commonOptions.targetDistance),console.log("Min distance:",this.commonOptions.minDistance),console.log("Envmap URL:",this.commonOptions.envmapUrl)}isValidURL(t){if(!t)return!1;try{return new URL(t,document.baseURI),!0}catch{return!1}}handleInteractivityChange(t){this.isInteractive=t,this.dispatchEvent(new CustomEvent("interactivity",{detail:{state:t}}))}startWorker(t){const i=t.transferControlToOffscreen(),n=new Worker(new URL("/monk-viewer/assets/offscreencanvas-worker-orbitcontrol-C8mLZvXm.js",import.meta.url),{type:"module"}),o=y(this),a=new m(t,n,o,this.limitPixelRatio);n.postMessage({type:"start",canvas:i,canvasId:a.id,...this.commonOptions},[i]),n.onmessage=l=>{l.data.type==="interactivity"&&this.handleInteractivityChange(l.data.state)}}initScene(){if(!this.canvas)return;const t=this.isValidURL(this.commonOptions.modelUrl),i=this.isValidURL(this.commonOptions.envmapUrl);if(!(t&&i)){console.warn("No valid model or envmap found. Scene won't be initialized.");return}this.canvas.transferControlToOffscreen!==void 0?this.startWorker(this.canvas):f({canvas:this.canvas,inputElement:this.canvas,...this.commonOptions,onInteractivityChange:n=>this.handleInteractivityChange(n)})}}customElements.define("monk-view",b);
