var v=Object.defineProperty;var f=(n,i,t)=>i in n?v(n,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[i]=t;var a=(n,i,t)=>f(n,typeof i!="symbol"?i+"":i,t);import{i as A}from"./renderer-1.0.0.js";function y(){return new Worker(new URL("offscreencanvas-worker-1.0.0.js",import.meta.url).href,{type:"module"})}const b=/android/i.test(navigator.userAgent),w=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||/Mac/.test(navigator.userAgent)&&navigator.maxTouchPoints>1,k=!!(window.webkit&&window.webkit.messageHandlers),R=(()=>{if(w){if(k)return!!/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent);{const n=document.createElement("a");return!!(n.relList&&n.relList.supports&&n.relList.supports("ar"))}}return!1})(),I=b&&!/firefox|OculusBrowser/i.test(navigator.userAgent);let d="none";R?d="quick-look":I&&(d="scene-viewer");function g(n){return Math.min(window.devicePixelRatio||1,n)}const u=class u{constructor(i,t,e,o){a(this,"id",u.nextId++);a(this,"worker");a(this,"element");a(this,"resizeObserver");a(this,"limitPixelRatio");this.worker=t,this.element=i,this.limitPixelRatio=o;const l=s=>{this.worker.postMessage({type:"event",id:this.id,data:s})};this.worker.postMessage({type:"makeProxy",id:this.id});const c=()=>{const s=this.element.getBoundingClientRect();l({type:"size",left:s.left,top:s.top,width:this.element.clientWidth,height:this.element.clientHeight,pixelRatio:g(this.limitPixelRatio)})};this.resizeObserver=new ResizeObserver(()=>{requestAnimationFrame(c)}),c(),this.resizeObserver.observe(i),this.attachHandlers(e,l)}attachHandlers(i,t){Object.entries(i).forEach(([e,o])=>{this.element.addEventListener(e,l=>{const c=o(l);t(c)})})}disconnect(){this.resizeObserver.disconnect()}};a(u,"nextId",0);let p=u;function r(n){return i=>n(i)}function O(n){return i=>{const t={type:i.type};return n.forEach(e=>{e in i&&(t[e]=i[e])}),t}}const x=n=>{const i=O(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pointerId","pageX","pageY"]),t=e=>({type:e.type,touches:Array.from(e.touches).map(o=>({pageX:o.pageX,pageY:o.pageY,clientX:o.clientX,clientY:o.clientY}))});return{contextmenu:r(e=>(e.preventDefault(),{type:e.type})),click:r(i),mousedown:r(i),mousemove:r(i),mouseup:r(i),mouseleave:r(i),pointerdown:r(i),pointermove:r(i),pointerup:r(i),pointerout:r(i),wheel:r(e=>(n.isInteractive&&e.preventDefault(),{type:e.type,deltaX:e.deltaX,deltaY:e.deltaY})),touchstart:r(t),touchend:r(t),touchmove:r(e=>(n.isInteractive&&e.preventDefault(),t(e))),keydown:r(e=>({type:e.type,key:e.key,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey}))}};function E(){const n=/Macintosh(?!.*KHTML).*Gecko/i.test(navigator.userAgent),i=/Android(?!.*KHTML).*Gecko/i.test(navigator.userAgent),t=/Android/i.test(navigator.userAgent);return n||i?{disableAA:!0,lowResolution:!0}:t?{disableAA:!0,lowResolution:!1}:{disableAA:!1,lowResolution:!1}}class L extends HTMLElement{constructor(){super();a(this,"canvas");a(this,"commonOptions");a(this,"isInteractive",!1);a(this,"limitPixelRatio",/Android/i.test(navigator.userAgent)?2:1/0);this.canvas=document.createElement("canvas");const t=this.isValidURL(this.getAttribute("model")||""),e=this.isValidURL(this.getAttribute("envmap")||""),o=parseFloat(this.getAttribute("target-distance")||"0.8"),l=parseFloat(this.getAttribute("min-distance")||"0.1"),c=parseFloat(this.getAttribute("max-distance")||"1.0"),s=parseFloat(this.getAttribute("init-delay")||"0.0"),h=parseFloat(this.getAttribute("init-delay-interactive")||"0.0"),m={stabilityDuration:parseFloat(this.getAttribute("perf-stability-duration")||"1.0"),measureDuration:parseFloat(this.getAttribute("perf-measure-duration")||"0.5")};this.commonOptions={pixelRatio:g(this.limitPixelRatio),modelUrl:t,envmapUrl:e,minDistance:l,targetDistance:o,maxDistance:c,initDelay:s,initDelayInteractive:h,lowPerformanceSettings:E(),perfSampling:m}}addARLink(){if(d==="none")return;const t=d==="quick-look"?"model-usdz":"model-glb",e=this.isValidURL(this.getAttribute(t)||"");if(!e)return;const o=this.getAttribute("model-title")||document.title||"model",c=this.getAttribute("ar-vertical")==="true"?"true":"false",s=document.createElement("a");if(s.textContent="AR",s.classList.add("ar-link"),d==="quick-look")s.setAttribute("rel","ar"),s.setAttribute("href",e);else if(d==="scene-viewer"){const h=window.location.href,m=`intent://arvr.google.com/scene-viewer/1.2?file=${encodeURIComponent(e)}&mode=ar_only&enable_vertical_placement=${c}&title=${encodeURIComponent(o)}#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(h)};end;`;s.setAttribute("href",m)}this.appendChild(s)}connectedCallback(){this.appendChild(this.canvas),this.logAttributes(),this.initScene(),this.addARLink()}logAttributes(){console.log("Model URL:",this.commonOptions.modelUrl),console.log("Max distance:",this.commonOptions.maxDistance),console.log("Target distance:",this.commonOptions.targetDistance),console.log("Min distance:",this.commonOptions.minDistance),console.log("Envmap URL:",this.commonOptions.envmapUrl)}isValidURL(t){if(!t)return null;try{return new URL(t,document.baseURI).href}catch{return null}}handleInteractivityChange(t){this.isInteractive=t,t?(this.setAttribute("interactive","true"),this.style.cursor="move"):(this.setAttribute("interactive","false"),this.style.cursor="pointer"),this.dispatchEvent(new CustomEvent("interactivity",{detail:{state:t}}))}handleOnLoaded(t){this.setAttribute("loaded","true"),this.dispatchEvent(new CustomEvent("loaded",{detail:{state:t}}))}startWorker(t){const e=t.transferControlToOffscreen(),o=new y,l=x(this),c=new p(t,o,l,this.limitPixelRatio);o.postMessage({type:"start",canvas:e,canvasId:c.id,...this.commonOptions},[e]),o.onmessage=s=>{switch(s.data.type){case"interactivity":this.handleInteractivityChange(s.data.state);break;case"loaded":this.handleOnLoaded(s.data.state);break}}}initScene(){if(this.canvas){if(!(this.commonOptions.modelUrl&&this.commonOptions.envmapUrl)){console.warn("No valid model or envmap found. Scene won't be initialized.");return}this.canvas.transferControlToOffscreen!==void 0?this.startWorker(this.canvas):A({canvas:this.canvas,inputElement:this.canvas,...this.commonOptions,e_interactivityChange:t=>this.handleInteractivityChange(t),e_loaded:t=>this.handleOnLoaded(t)})}}}customElements.define("monk-view",L);
