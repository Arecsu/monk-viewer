var d=Object.defineProperty;var u=(o,e,t)=>e in o?d(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var a=(o,e,t)=>u(o,typeof e!="symbol"?e+"":e,t);import{i as p}from"./shared-orbitcontrols-TPpICpdZ.js";import"./vendor-three-rghFcWz1.js";import"./gainmap-js-KANqE27d.js";import"./postprocessing-BTB-WKAv.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const l=class l{constructor(e,t,s){a(this,"id");a(this,"worker");a(this,"element");a(this,"resizeObserver");this.id=l.nextId++,this.worker=t,this.element=e;const n=c=>{this.worker.postMessage({type:"event",id:this.id,data:c})};this.worker.postMessage({type:"makeProxy",id:this.id});const r=()=>{const c=this.element.getBoundingClientRect();n({type:"size",left:c.left,top:c.top,width:this.element.clientWidth,height:this.element.clientHeight,pixelRatio:window.devicePixelRatio||1})};this.resizeObserver=new ResizeObserver(()=>{requestAnimationFrame(r)}),r(),this.resizeObserver.observe(e),this.attachHandlers(s,n)}attachHandlers(e,t){Object.entries(e).forEach(([s,n])=>{this.element.addEventListener(s,r=>{const c=n(r);t(c)})})}disconnect(){this.resizeObserver.disconnect()}};a(l,"nextId",0);let m=l;function i(o){return e=>o(e)}function h(o){return e=>{const t={type:e.type};return o.forEach(s=>{s in e&&(t[s]=e[s])}),t}}function f(){return o=>(o.preventDefault(),{type:o.type,touches:Array.from(o.touches).map(e=>({pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY}))})}const v=()=>{const o=h(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pointerId","pageX","pageY"]),e=f();return{contextmenu:i(t=>(t.preventDefault(),{type:t.type})),mousedown:i(o),mousemove:i(o),mouseup:i(o),mouseleave:i(o),pointerdown:i(o),pointermove:i(o),pointerup:i(o),pointerout:i(o),wheel:i(t=>(t.preventDefault(),{type:t.type,deltaX:t.deltaX,deltaY:t.deltaY})),touchstart:i(e),touchmove:i(e),touchend:i(e),keydown:i(t=>({type:t.type,key:t.key,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}))}};function g(){const o=/Macintosh(?!.*KHTML).*Gecko/i.test(navigator.userAgent),e=/Android(?!.*KHTML).*Gecko/i.test(navigator.userAgent);return o||e?{disableMSAA:!0,lowResolution:!0}:{disableMSAA:!1,lowResolution:!1}}class y extends HTMLElement{constructor(){super();a(this,"canvas");a(this,"modelUrl");a(this,"maxZoom");a(this,"minZoom");a(this,"envmapUrl");a(this,"commonOptions",{pixelRatio:window.devicePixelRatio||1,model:"",envmap:"",lowPerformanceSettings:g()});this.canvas=document.createElement("canvas"),this.modelUrl=this.getAttribute("model")||"",this.maxZoom=parseFloat(this.getAttribute("max-zoom")||"1.0"),this.minZoom=parseFloat(this.getAttribute("min-zoom")||"0.1"),this.envmapUrl=this.getAttribute("envmap")||"",this.commonOptions.model=this.getAttribute("model")||"",this.commonOptions.envmap=this.getAttribute("envmap")||""}connectedCallback(){this.appendChild(this.canvas),this.logAttributes(),this.initScene()}logAttributes(){console.log("Model URL:",this.modelUrl),console.log("Max Zoom:",this.maxZoom),console.log("Min Zoom:",this.minZoom),console.log("Envmap URL:",this.envmapUrl)}startWorker(t){console.log(t);const s=t.transferControlToOffscreen(),n=new Worker(new URL("/monk-viewer/assets/offscreencanvas-worker-orbitcontrol-COJNaH5b.js",import.meta.url),{type:"module"}),r=new m(t,n,v());n.postMessage({type:"start",canvas:s,canvasId:r.id,...this.commonOptions},[s])}initScene(){this.canvas&&(this.canvas.transferControlToOffscreen!==void 0?this.startWorker(this.canvas):p({canvas:this.canvas,inputElement:this.canvas,...this.commonOptions}))}}customElements.define("monk-view",y);
